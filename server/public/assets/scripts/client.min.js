var myApp=angular.module("myApp",["ngRoute"]);myApp.config(["$routeProvider",function(a){a.when("/home",{templateUrl:"/views/templates/home.html",controller:"LoginController"}).when("/register",{templateUrl:"/views/templates/register.html",controller:"LoginController"}).when("/user",{templateUrl:"/views/templates/user.html",controller:"UserController"}).when("/trips",{templateUrl:"/views/templates/trips.html",controller:"TripController",controllerAs:"trip"}).when("/packingList",{templateUrl:"/views/templates/packingList.html",controller:"PackingListController",controllerAs:"list"}).when("/invite",{templateUrl:"/views/templates/invite.html",controller:"InviteController",controllerAs:"invite"}).otherwise({redirectTo:"home"})}]),myApp.controller("InviteController",["MailService",function(a){var b=this;console.log("InviteController"),b.emailForm=a.emailInvite}]),myApp.controller("LoginController",["LoginService","$scope","$http","$location",function(a,b,c,d){console.log("loginservice here we are BEFORE: ",a.user),b.log=a.log,b.user=a.user,b.message=a.message,b.login=a.login,b.registerUser=a.registerUser,console.log("loginservice here we are AFTER: ",a.user)}]),myApp.controller("PackingListController",["PackingService","LoginService",function(a,b){var c=this;console.log("here lies user id: ",b.user.user_id),console.log("newItem when controller loads: ",c.newItem),c.postItem=function(b){a.postItem(b),c.newItem.name="",c.newItem.quantity=""},c.itemsObject=a.itemsObject,c.claimItem=function(c){var d={name:c.name,quantity:c.quantity,trip_id:a.selectedTrip.id,user_id:b.user.user_id};a.claimItem(d)},999!==a.selectedTrip.id&&a.getItems(a.selectedTrip.id)}]),myApp.controller("TripController",["LoginService","MailService","PackingService","$location",function(a,b,c,d){var e=this;console.log("TripController",a.user),c.getTrips(),e.log=c.log,e.createdTripObject=c.createdTripObject,e.invitedTripObject=c.invitedTripObject,e.joinedTripObject=c.joinedTripObject,e.postTrip=c.postTrip,e.deleteTrip=c.deleteTrip,e.joinTrip=c.joinTrip,e.inviteTrip=function(a){d.path("/invite")},e.printClickedTrip=function(a){c.selectedTrip.id=a,console.log("Boom, trip! ",c.selectedTrip),d.path("/packingList")}}]),myApp.controller("UserController",["$scope","$http","$location",function(a,b,c){console.log("checking user"),b.get("/user").then(function(b){b.data.username?(a.userName=b.data.username,console.log("User Data: ",a.userName)):c.path("/home")}),a.logout=function(){b.get("/user/logout").then(function(a){console.log("logged out"),c.path("/home")})}}]),myApp.factory("LoginService",["$http","$location",function(a,b){function c(){""===f.username||""===f.password?g="Enter your username and password":(console.log("sending to server...",f),a.post("/",f).then(function(a){a.data.username?(console.log("success: ",a.data),f.username=a.data.username,f.password=a.data.password,f.user_id=a.data.id,console.log(f.username),console.log(f.password),console.log(f.user_id),console.log("redirecting to user page"),b.path("/trips")):(console.log("failure: ",a),g="Wrong!!")}))}function d(){""===f.username||""===f.password?g="Choose a username and password":(console.log("sending to server...",f),a.post("/register",f).then(function(a){console.log("success"),b.path("/home")},function(a){console.log("error"),g="Please try again."}))}var e=console.log("inside login factory"),f={username:"",password:"",user_id:1},g="";return{login:c,registerUser:d,log:e,user:f,message:g}}]),myApp.factory("MailService",["$http",function(a){function b(b){console.log(b),a.post("/userTrip",b).then(function(a){console.log("hit postUserTrip",b),console.log("userTrip success: ",a)})}return{hit:"Inside MailService",emailInvite:function(b){console.log("line 7",b),a.post("/mail",b).then(function(a){console.log("Email sent: ",a.data)})},assignTripId:b}}]),myApp.factory("PackingService",["$http","$location",function(a,b){function c(){a.get("/trips").then(function(a){m.createdTripArray=a.data}),a.get("/userTrip").then(function(a){k.invitedTripArray=a.data}),a.get("/userTrip/joined").then(function(a){l.joinedTripArray=a.data})}function d(d){a.post("/trips",d).then(function(a){console.log("success: ",a),c(),b.path("/packingList")})}function e(b){console.log("hit joinTrip for:",b);var c={tripId:b.trip_id,userId:b.user_id};a.put("/userTrip",c).then(function(a){})}function f(a){console.log("hit deleteTrip for:",a)}function g(b){console.log("hit getItems",b),a({method:"GET",url:"/items",params:{tripId:b}}).then(function(a){j.itemsArray=a.data,console.log("items array: ",j.itemsArray)})}function h(b){var c={name:b.name,quantity:b.quantity,trip_id:n.id};console.log("inside factory: ",c),a.post("/items",c).then(function(a){}),g(c.trip_id)}function i(b){console.log("inside factory: ",b),a.post("/items/claim",b).then(function(a){console.log("hit postItem",b),console.log("success: ",a)}),g(b.trip_id)}var j={itemsArray:[]},k={invitedTripArray:[]},l={joinedTripArray:[]},m={createdTripArray:[]},n={id:""};return{log:"inside factory",postTrip:d,postItem:h,getTrips:c,getItems:g,createdTripObject:m,invitedTripObject:k,joinedTripObject:l,itemsObject:j,selectedTrip:n,selectedItem:{user_id:""},joinTrip:e,deleteTrip:f,claimItem:i}}]);